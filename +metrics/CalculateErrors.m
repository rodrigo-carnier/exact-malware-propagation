function [RMSE, MAX, Sf, Tcte] = CalculateErrors(turn_analysis)

% clearvars -except turn_analysis;

initParam;
param.mcModel
switch param.malware
    
    case 'SIS'
        namesim = strcat('sis_simul_a',strcat(num2str(param.alpha*100), '_b',num2str(param.beta*100),'.mat'));
        namemc = strcat('sis_mc_a',strcat(num2str(param.alpha*100), '_b',num2str(param.beta*100), '_',param.mcModel,'.mat'));
        load(namesim);
        load(namemc);
        
        time = report(1:turn_analysis+1,1);
        data_sim = report;
        data_sim(1:turn_analysis+1,2:end) = data_sim(1:turn_analysis+1,2:end)/param.n;
        data_mc = Pt(:,1:turn_analysis+1)';

        error_Susceptible = data_sim(:,2) - data_mc(:,1);
        error_Infected = data_sim(:,3)-data_mc(:,2);
        
        RMSE = sqrt(mean((error_Susceptible).^2));
        MAX=max(abs(error_Susceptible));

        Sf = data_mc(end,1);
        delta = data_mc(end,1)-data_mc(1,1);
        signal = delta/abs(delta);
        
        if param.alpha/param.beta > 1

            switch(signal)
                case -1
                    [Tcte_vec, ~] = find(data_mc(:,1)<=1.05*data_mc(end,1));
                case 1
                    [Tcte_vec, ~] = find(data_mc(:,1)>=0.95*data_mc(end,1));
            end
                
        else
            
            switch(signal)
                case -1
                    disp('test0')
                    Tcte_vec = find(data_mc(:,1)<=0.05);
                case 1
                    disp('test1')
                    Tcte_vec = find(data_mc(:,1)>=0.95);
            end

        end

        Tcte = Tcte_vec(1);
        
        figure(28);
        plot(time, error_Susceptible, 'LineWidth', 2);
        hold on
        plot(time, error_Infected, 'LineWidth', 2);
        hold off
        % % axis([0 1 0 1]);
%         axis([0 param.max_turns -0.0025 0.0025]);
        legend('S','I','Location', 'North');
        title(strcat('Errors: Simulation-', param.mcModel,' Markov chain (SEIRS)'));
        xlabel('Time(s)');
        ylabel('Percentage of Devices');
        print('-dpng',strcat('sis_error_a', num2str(param.alpha*100),'_b',num2str(param.beta*100),'_',param.mcModel,'.png'), 'Resolution', 600);
        save(strcat('sis_error_a', num2str(param.alpha*100),'_b',num2str(param.beta*100),'_',param.mcModel,'.mat'));
        
    case 'SEIRS'
        
        namesim = strcat('seirs_simul_a', num2str(param.alpha*100),'_b',num2str(param.beta*100),'.mat');
        namemc = strcat('seirs_mc_a', num2str(param.alpha*100),'_b',num2str(param.beta*100),'_',param.mcModel,'.mat');
        load(namesim);
        load(namemc);
        
        time = report(1:turn_analysis+1,1);
        data_sim = report;
        data_sim(1:turn_analysis+1,2:end) = data_sim(1:turn_analysis+1,2:end)/param.n;
        data_mc = Pt(:,1:turn_analysis+1)';

        error_Susceptible = data_sim(:,2) - data_mc(:,1);
        error_Infected = data_sim(:,4)-data_mc(:,3);
        
        RMSE = sqrt(mean((error_Susceptible).^2));
        MAX=max(abs(error_Susceptible));

        Sf = data_mc(end,1);
        delta = data_mc(end,1)-data_mc(1,1);
        signal = delta/abs(delta);
        
        if param.alpha/param.beta > 1

            switch(signal)
                case -1
                    [Tcte_vec, ~] = find(data_mc(:,1)<=1.05*data_mc(end,1));
                case 1
                    [Tcte_vec, ~] = find(data_mc(:,1)>=0.95*data_mc(end,1));
            end
                
        else
            
            switch(signal)
                case -1
                    disp('test0')
                    Tcte_vec = find(data_mc(:,1)<=0.05);
                case 1
                    disp('test1')
                    Tcte_vec = find(data_mc(:,1)>=0.95);
            end

        end

        Tcte = Tcte_vec(1);
        
        
        figure(28);
        % figure
        plot(time, error_Susceptible, 'LineWidth', 2);
        hold on
        plot(time, error_Infected, 'LineWidth', 2);
        hold off
        % % axis([0 1 0 1]);
%         axis([0 param.max_turns -0.0025 0.0025]);
        legend('S','I','Location', 'North');
        title(strcat('Errors: Simulation-', param.mcModel,' Markov chain (SEIRS)'));
        xlabel('Time(s)');
        ylabel('Percentage of Devices');
        print('-dpng',strcat('seirs_error_a', num2str(param.alpha*100),'_b',num2str(param.beta*100),'_',param.mcModel,'.png'), 'Resolution', 600);
        save(strcat('seirs_error_a', num2str(param.alpha*100),'_b',num2str(param.beta*100),'_',param.mcModel,'.mat'));
        
    case '2SEIS'
        namesim = strcat('2seis_simul_a', num2str(param.alpha*100),'_b',num2str(param.beta*100),'.mat');
        namemc = strcat('2seis_mc_a', num2str(param.alpha*100),'_b',num2str(param.beta*100),'_',param.mcModel,'.mat');
        load(namesim);
        load(namemc);
        
        time = report(1:turn_analysis+1,1);
        data_sim = report;
        data_sim(1:turn_analysis+1,2:end) = data_sim(1:turn_analysis+1,2:end)/param.n;
        data_mc = Pt(:,1:turn_analysis+1)';

        error_Susceptible = data_sim(:,2) - (data_mc(:,1)+data_mc(:,3));
        error_Infected = data_sim(:,4)  - (data_mc(:,2)+data_mc(:,5));
        
        RMSE = sqrt(mean((error_Susceptible).^2));
        MAX=max(abs(error_Susceptible));

        Sf = (data_mc(end,1)+data_mc(end,3));
        delta = (data_mc(end,1)+data_mc(end,3)) - (data_mc(1,1)+data_mc(1,3));
        signal = delta/abs(delta);
        
        if param.alpha/param.beta > 1

            switch(signal)
                case -1
                    disp('test0')
                    [Tcte_vec, ~] = find((data_mc(:,1)+data_mc(:,3))<=1.05*(data_mc(end,1)+data_mc(end,3)));
                case 1
                    disp('test1')
                    [Tcte_vec, ~] = find((data_mc(:,1)+data_mc(:,3))>=0.95*(data_mc(end,1)+data_mc(end,3)));
            end
                
        else
            
            switch(signal)
                case -1
                    disp('test2')
                    Tcte_vec = find((data_mc(:,1)+data_mc(:,3))<=0.05);
                case 1
                    disp('test3')
                    Tcte_vec = find((data_mc(:,1)+data_mc(:,3))>=0.95);
            end

        end

        Tcte = Tcte_vec(1);
        
        
        figure(28);
        % figure
        plot(time, error_Susceptible, 'LineWidth', 2);
        hold on
        plot(time, error_Infected, 'LineWidth', 2);
        hold off
        % % axis([0 1 0 1]);
%         axis([0 param.max_turns -0.0025 0.0025]);
        legend('S','I','Location', 'North');
        title(strcat('Errors: Simulation-', param.mcModel,' Markov chain (2SEIS)'));
        xlabel('Time(s)');
        ylabel('Percentage of Devices');
        print('-dpng',strcat('2seis_error_a', num2str(param.alpha*100),'_b',num2str(param.beta*100),'_',param.mcModel,'.png'), 'Resolution', 600);
        save(strcat('2seis_error_a', num2str(param.alpha*100),'_b',num2str(param.beta*100),'_',param.mcModel,'.mat'));
        
end


end