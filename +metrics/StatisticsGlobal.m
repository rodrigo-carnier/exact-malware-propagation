clear all;

percentages = zeros(100,6);

initGlobal;
devices = param.n;
successes = 0;
failures = 0;
success_percentages = zeros(6,1);

report = zeros(param.max_turns+1,7,param.max_stats);

for jjj=1:param.max_stats
    clearvars network network_update report_total;
    jjj
    initGlobal;
    SimulateGlobalConcomitant;
    
    report(1:size(report_total,1),1:size(report_total,2),jjj) = report_total;
    report(:,1,jjj) = 0:param.max_turns;
    for kkk=size(report_total,1)+1:param.max_turns+1
        report(kkk,2:end-1,jjj) = report_total(size(report_total,1),2:end-1);
    end

    % Max number of infected devices
    percentages(jjj,1) = max(report_total(:,3));
    
    % Standard deviation of infected devices
    percentages(jjj,2) = std(report_total(:,3));
        
   if report_total(end,1) < param.max_turns -1
%         successes = successes + 1;
%         success_percentages(1) = success_percentages(1) + percentages(jjj,1);
%         success_percentages(2) = success_percentages(2) + percentages(jjj,2);
%         success_percentages(3) = success_percentages(3) + percentages(jjj,3);
%         success_percentages(4) = success_percentages(4) + percentages(jjj,4);
%         success_percentages(5) = success_percentages(5) + percentages(jjj,5);
%         success_percentages(6) = success_percentages(6) + percentages(jjj,6);
    else
        failures = failures + 1;
    end

end


report_mean(:,1) = 1:size(report,1);
for i=1:size(report_total,1)
    for j=2:size(report_total,2)
        report_mean(i,j) = mean(report(i,j,:));
    end
end

% % Clean devices
% report_statistics_success(1) = success_percentages(1)/successes;
% 
% % RAM devices
% report_statistics_success(2) = success_percentages(2)/successes;
% 
% % Powered ROM devices
% report_statistics_success(3) = success_percentages(3)/successes;
% 
% % Neutralized ROM devices
% report_statistics_success(4) = success_percentages(4)/successes;
% 
% % On
% report_statistics_success(5) = success_percentages(5)/successes;
% 
% % Off
% report_statistics_success(6) = success_percentages(6)/successes;

max_maxinfec = max(percentages(:,1))
max_std = max(percentages(:,2))

% Average of Max number of infected devices
report_statistics_all(1) = mean(percentages(:,1));

% Standard deviation of Average of Max number of infected devices
report_statistics_all(2) = std(percentages(:,1));

% Average Standard deviation of infected devices
report_statistics_all(3) = mean(percentages(:,2))
disp('.');
disp('1) Average of Max number of infected devices.')
disp('2) Standard deviation of Average of Max number of infected devices.')
disp('3) Average Standard deviation of infected devices');
disp('.');



switch param.malware
    case 'SIS'
        Plot_MSM_statistics;
    case 'SIQ'
        Plot_ACM_statistics;
end