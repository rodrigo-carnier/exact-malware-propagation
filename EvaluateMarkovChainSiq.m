clear all;

% mode = 'linear';
% mode = 'nonlinearmod';
% mode = 'nonlinear';
% mode = 'combinatory3rd';
mode = 'combinatoryExact';
% mode = 'onlyir';
% mode = 'onlydr';


initParam;
P0 = [param.init_susceptible_devs; param.init_infected_devs; param.init_quarantine_devs]/param.n;
Pt(:,1) = P0;
i = 1;
while i < param.max_turns
    i = 1+i; 
    Pt(:,i) = markovs.MarkovChainSiq(Pt(:,i-1), param.IR, param.DR, mode, param.depth, param.n);
end

turns = (0:i-1);

switch mode
    case 'linear'
        figure(71);
        % figure
        plot(turns,Pt,'LineWidth', 2)
        axis([0 param.max_turns -0.1 1.1]);
        legend('Susceptible','Infectious', 'Quarantined', 'Location', 'North');
        title('SIS model states, Markov linear');
        xlabel('Time(s)');
        ylabel('Percentage of Devices');
        print('-djpeg90','-r300',strcat(datestr(now,29),'_ACM_siq_MClinear',num2str(param.IR*100),num2str(param.DR*100)));
    case 'nonlinear'
        figure(72);
        % figure
        plot(turns,Pt,'LineWidth', 2)
        axis([0 param.max_turns 0 1]);
        legend('Susceptible','Infectious', 'Quarantined', 'Location', 'North');
        title('SIS model states, Markov nonlinear');
        xlabel('Time(s)');
        ylabel('Percentage of Devices');
        print('-djpeg90','-r300',strcat(datestr(now,29),'_ACM_siq_MCnonlinear',num2str(param.IR*100),num2str(param.DR*100)));
    case 'onlyir'
        figure(73);
        % figure
        plot(turns,Pt,'LineWidth', 2)
        axis([0 param.max_turns 0 1]);
        legend('Susceptible','Infectious', 'Quarantined', 'Location', 'North');
        title('SIS model states (Only Infection)');
        xlabel('Time(s)');
        ylabel('Percentage of Devices');
        print('-djpeg90','-r300',strcat(datestr(now,29),'_ACM_siq_onlyIR',num2str(param.IR*100),num2str(param.DR*100)));
    case 'onlydr'
        figure(74);
        % figure
        plot(turns,Pt,'LineWidth', 2)
        axis([0 param.max_turns 0 1]);
        legend('Susceptible','Infectious', 'Quarantined', 'Location', 'North');
        title('SIS model states  (Only Detection)');
        xlabel('Time(s)');
        ylabel('Percentage of Devices');
        print('-djpeg90','-r300',strcat(datestr(now,29),'_ACM_siq_onlyDR',num2str(param.IR*100),num2str(param.DR*100)));
    case 'combinatory3rd'
        figure(75);
        % figure
        plot(turns,Pt,'LineWidth', 2)
        axis([0 param.max_turns 0 1]);
        legend('Susceptible','Infectious', 'Quarantined', 'Location', 'North');
        title('SIS model states, Markov combinatory Approx');
        xlabel('Time(s)');
        ylabel('Percentage of Devices');
        print('-djpeg90','-r300',strcat(datestr(now,29),'_ACM_siq_MCcombinatory3rd',num2str(param.IR*100),num2str(param.DR*100)));
    case 'combinatoryExact'
        figure(76);
        % figure
        plot(turns,Pt,'LineWidth', 2)
        axis([0 param.max_turns 0 1]);
        legend('Susceptible','Infectious', 'Quarantined', 'Location', 'North');
        title('SIQ model states (ACM), Markov combinatory Exact');
        xlabel('Time(s)');
        ylabel('Percentage of Devices');
        print('-djpeg90','-r300',strcat(datestr(now,29),'_ACM_siq_MCcombinatoryExact_',num2str(param.IR*100),num2str(param.DR*100)));
    case 'nonlinearmod'
        figure(77);
        % figure
        plot(turns,Pt,'LineWidth', 2)
        axis([0 param.max_turns 0 1]);
%         axis([0 10 0 1]);
        legend('Susceptible','Infectious', 'Quarantined', 'Location', 'North');
        title('SIS model states, Markov nonlinear');
        xlabel('Time(s)');
        ylabel('Percentage of Devices');
        print('-djpeg90','-r300','_ACM_siq_mcnonlin');
        print('-djpeg90','-r300',strcat(datestr(now,29),'_ACM_sis_MCmodule',num2str(param.IR*100),num2str(param.DR*100)));
end

savename = strcat('SIQ_mc',strcat(num2str(param.IR*100),num2str(param.DR*100)));
save(savename)