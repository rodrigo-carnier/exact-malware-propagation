clear all;

initParam;
threshold = max([param.omega param.tau]);

P0 = [param.init_susceptible_devs; 0; param.init_infected_devs; 0; 0]/param.n;
Pt(:,1:threshold) = zeros(5,threshold);
Pt(:,threshold+1) = P0;

i = threshold+1;

param
while i <= param.max_turns+threshold
% while i <= threshold+4

    i = 1+i;
    [Pt, Inf1, Inf2, Mit1, Mit2, Di, Ci] = markovs.MarkovChainSeirs(Pt, param.mcModel, param.n, param.alpha, param.beta, param.G, param.omega, param.tau, param.epsilon, i);
    D(i) = Di;
    C(i) = Ci;

end
Pt = Pt(:,1+threshold:end);

nameParam = strcat('seirs_mc_a', num2str(param.alpha*100),'_b',num2str(param.beta*100));
% nameParam = strcat(datestr(now,29), '_seirs_mc_a', num2str(param.alpha*100),'_b',num2str(param.beta*100),'_o',num2str(param.omega),'_t',num2str(param.tau),'_fpr',num2str(param.FPR*100),'_g',num2str(param.G));

f = figure(82)
plot((0:param.max_turns)',100*Pt(1,1:end), 'blue', 'LineWidth', 2)
hold on;
plot((0:param.max_turns)',100*Pt(2,1:end), 'color',[1 0.5 0], 'LineWidth', 2)
plot((0:param.max_turns)',100*Pt(3,1:end), 'red', 'LineWidth', 2)
plot((0:param.max_turns)',100*Pt(4,1:end), 'color',[0 0.5 0], 'LineWidth', 2)
% plot((0:param.max_turns)',100*Pt(5,1:end), 'black', 'LineWidth', 2)
hold off;
ytickformat('percentage');
axis([0 param.max_turns 0 100]);
legend('Susceptible','Exposed', 'Infected', 'Recovered', 'Location', 'North');
% legend('Susceptible','Exposed', 'Infected', 'Recovered', 'Dead', 'Location', 'North');
title(strcat('SEIRS model (', param.mcModel, ') \omega=', num2str(param.omega), ', \tau=', num2str(param.tau)));
xlabel('Turn');
ylabel('Percentage of Devices');

savename = strcat(nameParam,'_',param.mcModel, '.mat');
save(savename)

exportgraphics(f,strcat(nameParam,'_',param.mcModel, '.png'), 'Resolution', 600);

