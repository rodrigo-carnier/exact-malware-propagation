# Exact models of random propagation of malware

This repository contains the Matlab scripts used in Carnier et.all [1][2][3] to validate the proposed exact mathematical model of random propagation of malware (by random propagation we refer to the main sub-dynamics of a mathematical model of malware like SIS, SEIRS, etc).

Our model is proposed as a substitute to the standard nonlinear model found in >95% of the literature. Below we show the usage of both models inside the simplest compartmental malware model SIS.

## Proposed vs Standard models of random propagation

Both models are nonlinear, being used in numerical evaluations rather than closed-form solutions. As trade-off for the exactness of our model, it has only two more operations than the standard model.

In the equations below, $I_n$ is the number of new infections created this turn $T$, $S$ is the number of susceptible devices, $I$ is the number of infected devices, $\alpha$ is the rate of infection, $\beta$ is the rate of cleaning and $N$ is the total number of devices in the network.

### Exact Markov chain model of random propagation

$$I_{n}[T] = S[T]\left(1 - \left( 1 - \dfrac{\alpha}{N} \right)^{I[T]} \right)$$

### Standard nonlinear model of random propagation 

$$I_{n}[T] = \alpha S[T] \dfrac{I[T]}{N}$$

### Usage of random propagation dynamics in the complete SIS model

$$S[T+1] - S[T] = - I_{n}[T] + \beta I[T]$$

$$I[T+1] - I[T] = I_{n}[T] - \beta I[T]$$

# Usage of repository

The repository contains two types of scripts: one for the evaluation of the mathematical malware model and another for the execution of the simulation malware model. Their results are independent because the former is deterministic while the latter is stochastic regarding the evaluation of the rates of infection and cleaning. Moreover, the mathematical model is a compartmental model that does not keep track of the state of individual devices, while the simulation does keep track of the state of every device and performs random tests for every attempt of infection and detection.

Execute all scripts from the main folder (do not enter the folders +metrics or +plots to execute the steps 4 and 5 below).

### Scripts in main folder

0. Before executing the sequence of scripts below, always clear the workpace.
```bash
clear all;
```

1. Run the script that initializes all parameters used in the files of this repository (rate of infection, of detection, size of network, etc). Important parameters to set up inside this file are: param.malware, param.mcModel, param.alpha and param.beta.

```bash
initParam;
```

2. Evaluate the Markov chain of a specific compartmental model. Just run one of the scripts below. It will generate a .mat file that is required to calculate the error between the Markov chain model and its respective simulation (step 5).

```bash
EvaluateMarkovChainSis;
EvaluateMarkovChainSeirs;
EvaluateMarkovChain2Seis;
EvaluateMarkovChainSii;
EvaluateMarkovChainSiq;
```

3. Simulate the same malware model from step 2. The simulation will generate the second .mat file that is required in step 5. The simulation model is considered the "perfect" model of a network and is used as a base of comparison with the predictions of the Markov chains.

```bash
SimulateSisGlobal;
SimulateSeirsGlobal;
Simulate2SeisGlobal;
SimulateSisLocal;
```

4. Calculate the errors of susceptible and infected populations between the Markov chain prediction and the simulation result. This script needs the two .mat files generated by the scripts of step 2 (EvaluateMarkovChain___) and step 3 (Simulate___). Step 4 will generate another .mat file with the calculation of the error between the simulation and the chosen Markov chain model (the most important models to compare are 'standard' and 'proposed').

```bash
metrics.CalculateErrors;
```

5. Compare the errors of step 4 between two different Markov chain models. This script needs two .mat files generated by step 4, one for the 'standard' MC model and another for the 'proposed' MC model. Therefore, you need to run steps 1 to 4 two times, changing the parameter param.mcModel inside the script initParam.m in each time. E.g. in the first time define param.mcModel = 'standard', then in the second time define param.mcModel = 'proposed'. Then after generating the files sis_error_a25_b12.5_standard.mat and sis_error_a25_b12.5_proposed.mat, execute the script below.

```bash
plots.CompareErrorsStandardProposedMarkovChains;
```

### Folder +markovs

Folder with functions containing dynamics of each Markov chain modeled in the papers. Inputs are current system state, parameters and control variables of mitigation (G), output is next system state.

### Folder +infecmodels

Functions that perform the infection phase in the simulation and alter the state matrix in the simulation. Specific to each compartmental model.

### Folder +mitigmodels

Functions that perform the mitigation phase (cleaning of malware) in the simulation and alter the state matrix in the simulation. Specific to each compartmental model and topology of network.

### Folder +init and +simultools

Functions for manipulation of the simulation matrix containing the states of individual devices.

### Folder +metrics

Functions for calculation of the metrics of validation of Markov chains against simulations, used in paper [1].

### Folder +plots

Scripts for creating time-series figures for the evolution of compartmental populations (susceptible, infected, exposed, recovered, dead, etc). Plots also errors between the Markov chain of a specific model (SIS, SEIRS, etc) and its respective simulation.

### Data

Every evaluation of Markov chains and run of simulations saves a .mat file that is used by scripts in the folder +metrics.

## Funding

This research was conducted under a contract of “Research and development on IoT malware removal / make it non-functional technologies for effective use of the radio spectrum” among “Research and Development for Expansion of Radio Wave Resources (JPJ000254)”, which was supported by the Ministry of Internal Affairs and Communications, Japan.

## References

If this repository is used in your work in any capacity, please cite one of our works [1] [2] [3], as applicable according to the description below:

In [1] we apply the proposed exact propagation dynamics in three malware models, SIS, SEIRS and 2SEIS. In [2] we first propose the propagation model and propose a controlled mass mitigation strategy based on a multiplicative parameter G that affects the entire network; we also derive the exact Markov chain model for the mitigation dynamics. In [3] we investigate a controlled mitigation strategy of groups devices on a network tree model that affects only local devices, purely through simulations. Scripts from [3] in this repository are not updated and will probably need some work to execute.

[1] Carnier, R. M.; Li, Y.; Fujimoto, Y.; Shikata, J.
"Deriving Exact Mathematical Models of Malware Based on Random Propagation,"
Mathematics, Vol.12, No.6, pp. 835, March 2024, DOI: [10.3390/math12060835](https://www.mdpi.com/2227-7390/12/6/835).

[2] Carnier, R.M.; Li, Y.; Fujimoto, Y.; Shikata, J.
"Exact Markov Chain of Random Propagation of Malware with Network-Level Mitigation,"
IEEE Internet of Things Journal, Vol.10, No.12, pp.10933-10947, June 2023, DOI: [10.1109/JIOT.2023.3240421](https://ieeexplore.ieee.org/document/10029367).

[3] Carnier, R.M.; Li, Y.; Fujimoto, Y.; Shikata, J.
"Modeling of Malware Propagation in IoT Network and Mitigation in Area based on Local Routing Depth,"
7th IEEJ International Workshop on Sensing, Actuation, Motion Control, and Optimization (SAMCON), pp.336-341, Tokyo, Japan, 2021, [paper pdf](https://www.researchgate.net/publication/350546539_Modeling_of_Malware_Propagation_in_IoT_Network_and_Mitigation_in_Area_based_on_Local_Routing_Depth).
