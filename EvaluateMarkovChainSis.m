% clear all;

initParam;
% P0 = [param.init_susceptible_devs; param.init_infected_devs];
% P0 = [param.init_susceptible_devs; param.init_infected_devs]/param.n;
P0 = [0.9; 0.1];
P0
Pt(:,1) = P0;
i = 1;
while i <= param.max_turns
    i = 1+i; 
    [Pti, ~, ~, Di, Ci] = markovs.MarkovChainSis(Pt(:,i-1), param.mcModel, param.n, param.alpha, param.beta, param.G);
    Pt(:,i) = Pti;
    D(i) = Di;
    C(i) = Ci;
end

nameParam = strcat('sis_mc_a', num2str(param.alpha*100),'_b',num2str(param.beta*100));
% nameParam = strcat('sis_mc_a', num2str(param.alpha*100),'_b',num2str(param.beta*100),'_fpr',num2str(param.FPR*100),'_g',num2str(param.G));

switch param.mcModel
    case 'proposed'
        disp('test')
        nameModel = '_proposed';
        savename = strcat(nameParam,nameModel, '.mat');
        save(savename)
        f = figure(71);
        % figure
        plot((0:param.max_turns)',100*Pt(1,:), 'blue', 'LineWidth', 2)
        hold on;
        plot((0:param.max_turns)',100*Pt(2,:), 'red', 'LineWidth', 2)
        plot((1:param.max_turns)',100*D(2:param.max_turns+1), 'color',[0 0.5 0], 'LineWidth', 2)
        plot((1:param.max_turns)',100*C(2:param.max_turns+1), 'black', 'LineWidth', 2)
        hold off;
        ytickformat('percentage');
        axis([0 param.max_turns 0 100]);
        legend('Susceptible', 'Infected', 'Detected','Reset', 'Location', 'North');
        title(strcat('MC: \alpha=', num2str(param.alpha),', \beta=',  num2str(param.beta), ', FPR=',num2str(param.FPR),', FNR=', num2str(1-param.beta), ', G=',num2str(param.G)), 'FontSize', 16);
        xlabel('Turn');
        ylabel('Percentage of Devices');
        exportgraphics(f,strcat(nameParam,nameModel, '.png'), 'Resolution', 600);
    case 'standard'
        nameModel = '_standard';
        savename = strcat(nameParam,nameModel, '.mat');
        save(savename)
        f = figure(72);
        % figure
        plot((0:param.max_turns)',100*Pt,'LineWidth', 2)
        ytickformat('percentage');
        axis([0 param.max_turns 0 100]);
        legend('Susceptible','Infected', 'Location', 'North');
        title('SIS states, Literature standard Model');
        xlabel('Turn');
        ylabel('Percentage of Devices');
        exportgraphics(f,strcat(nameParam,nameModel, '.png'), 'Resolution', 600);
    case 'linear'
        nameModel = '_linear';
        savename = strcat(nameParam,nameModel, '.mat');
        save(savename)
        f = figure(73);
        % figure
        plot((0:param.max_turns)',100*Pt,'LineWidth', 2)
        ytickformat('percentage');
        axis([0 param.max_turns 0 100]);
        legend('Susceptible','Infected', 'Location', 'North');
        title('SIS states, Literature Linear Model');
        xlabel('Turn');
        ylabel('Percentage of Devices');
        exportgraphics(f,strcat(nameParam,nameModel, '.png'), 'Resolution', 600);
    case 'onlyInfection'
        nameModel = '_onlyir';
        savename = strcat(nameParam,nameModel, '.mat');
        save(savename)
        f = figure(74);
        % figure
        plot((0:param.max_turns)',100*Pt,'LineWidth', 2)
        ytickformat('percentage');
        axis([0 param.max_turns 0 100]);
        legend('Susceptible','Infected', 'Location', 'North');
        title(strcat('Exact Markov Chain (Only Infection), \alpha=', num2str(param.alpha)));
        xlabel('Turn');
        ylabel('Percentage of Devices');
        exportgraphics(f,strcat(nameParam,nameModel, '.png'), 'Resolution', 600);
    case 'onlyMitigation'
        nameModel = '_onlydr';
        savename = strcat(nameParam,nameModel, '.mat');
        save(savename)
        f = figure(75);
        % figure
        plot((0:param.max_turns)',100*Pt,'LineWidth', 2)
        ytickformat('percentage');
        axis([0 param.max_turns 0 100]);
        legend('Susceptible','Infected', 'Location', 'North');
        title(strcat('Exact Markov Chain (Only Detection), \beta=',num2str(param.beta),', G=',num2str(param.G)));
        xlabel('Turn');
        ylabel('Percentage of Devices');
exportgraphics(f,strcat(nameParam,nameModel, '.png'), 'Resolution', 600);
    case 'combinatory3rd'
        nameModel = '_combinatory3rd';
        savename = strcat(nameParam,nameModel, '.mat');
        save(savename)
        f = figure(76);
        % figure
        plot((0:param.max_turns)',100*Pt,'LineWidth', 2)
        ytickformat('percentage');
        axis([0 param.max_turns 0 100]);
        legend('Susceptible','Infected', 'Location', 'North');
        title('SIS states, Approximated Markov Chain Model');
        xlabel('Turn');
        ylabel('Percentage of Devices');
exportgraphics(f,strcat(nameParam,nameModel, '.png'), 'Resolution', 600);
    case 'module'
        nameModel = '_module';
        savename = strcat(nameParam,nameModel, '.mat');
        save(savename)
        f = figure(77);
        % figure
        plot((0:param.max_turns)',100*Pt,'LineWidth', 2)
        ytickformat('percentage');
        axis([0 param.max_turns 0 100]);
        legend('Susceptible','Infected', 'Location', 'North');
        title('SIS states, Nonrepeat Attack Model');
        xlabel('Turn');
        ylabel('Percentage of Devices');
        exportgraphics(f,strcat(nameParam,nameModel, '.png'), 'Resolution', 600);
end



% [data_sim, data_mc] = PlotErrors(param.alpha, param.beta, param.G, param)